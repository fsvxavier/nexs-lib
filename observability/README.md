# Nexs Observability Library

Biblioteca completa de observabilidade para aplica√ß√µes Go, fornecendo instrumenta√ß√£o padronizada para **logging**, **tracing** e **metrics** com suporte a m√∫ltiplos providers e infraestrutura Docker para desenvolvimento e testes.

## üéØ Vis√£o Geral

A Nexs Observability Library oferece uma solu√ß√£o unificada para instrumenta√ß√£o de aplica√ß√µes, permitindo:

- **Logging estruturado** com m√∫ltiplos backends
- **Distributed tracing** com providers populares
- **Infraestrutura completa** para desenvolvimento e testes
- **Integra√ß√£o simples** e APIs consistentes
- **Performance otimizada** com baixo overhead

## üì¶ Componentes

### üîç Logger
Sistema de logging estruturado com suporte a m√∫ltiplos providers.

**Providers Suportados:**
- **Zap**: High-performance structured logging
- **Logrus**: Feature-rich logging library
- **Slog**: Go's native structured logging (1.21+)

### üìä Tracer  
Sistema de distributed tracing com integra√ß√£o a plataformas populares.

**Providers Suportados:**
- **Datadog**: APM integration completa
- **Grafana Tempo**: Backend de tracing open-source
- **New Relic**: Full observability platform
- **OpenTelemetry**: Vendor-neutral tracing

### üê≥ Infrastructure
Stack completa Docker para desenvolvimento e testes com:
- **Tracing**: Jaeger, Tempo, OpenTelemetry Collector
- **Logging**: Elasticsearch, Logstash, Fluentd, Kibana
- **Metrics**: Prometheus, Grafana
- **Databases**: PostgreSQL, MongoDB, Redis, RabbitMQ

## üöÄ Quick Start

### Instala√ß√£o

```bash
go get github.com/fsvxavier/nexs-lib/observability
```

### Logger B√°sico

```go
package main

import (
    "context"
    "github.com/fsvxavier/nexs-lib/observability/logger"
    "github.com/fsvxavier/nexs-lib/observability/logger/providers/zap"
)

func main() {
    // Configurar logger
    config := zap.Config{
        Level:    "info",
        Format:   "json",
        AddStack: true,
    }
    
    provider := zap.NewZapProvider(config)
    log := logger.NewLogger(provider)
    
    // Usar logger
    ctx := context.Background()
    log.Info(ctx, "Aplica√ß√£o iniciada", 
        logger.String("service", "api"),
        logger.Int("port", 8080),
    )
}
```

### Tracer B√°sico

```go
package main

import (
    "context"
    "github.com/fsvxavier/nexs-lib/observability/tracer"
    "github.com/fsvxavier/nexs-lib/observability/tracer/providers/opentelemetry"
)

func main() {
    // Configurar tracer
    config := opentelemetry.Config{
        ServiceName: "my-service",
        Endpoint:    "http://localhost:4317",
        Environment: "development",
    }
    
    provider := opentelemetry.NewOpenTelemetryProvider(config)
    tracer := tracer.NewTracer(provider)
    
    // Criar span
    ctx := context.Background()
    span := tracer.StartSpan(ctx, "operation-name")
    defer span.End()
    
    span.SetTag("user.id", "12345")
    span.SetTag("operation.type", "database-query")
}
```

### Infraestrutura de Desenvolvimento

```bash
# Clonar reposit√≥rio
git clone <repository-url>
cd nexs-lib/observability/infrastructure

# Iniciar stack completa
make infra-up

# Verificar status
make infra-status

# Acessar UIs
# Jaeger: http://localhost:16686
# Grafana: http://localhost:3000 (admin/nexs123)  
# Kibana: http://localhost:5601
```

## üìö Documenta√ß√£o Detalhada

### Logger
- [üìñ Logger README](./logger/README.md) - Documenta√ß√£o completa
- [üîß Logger Providers](./logger/providers/) - Configura√ß√£o de providers
- [üí° Logger Examples](./logger/examples/) - Exemplos pr√°ticos

### Tracer
- [üìñ Tracer README](./tracer/README.md) - Documenta√ß√£o completa
- [üîß Tracer Providers](./tracer/providers/) - Configura√ß√£o de providers  
- [üí° Tracer Examples](./tracer/examples/) - 6 exemplos completos

### Infrastructure
- [üìñ Infrastructure README](./infrastructure/README.md) - Setup completo
- [üîß Infrastructure Config](./infrastructure/configs/) - Configura√ß√µes
- [üìã Infrastructure Next Steps](./infrastructure/NEXT_STEPS.md) - Roadmap

## üèóÔ∏è Arquitetura

### Padr√£o de Design

```
Application Code
       ‚Üì
   Nexs Logger/Tracer (Interface)
       ‚Üì
   Provider Abstraction
       ‚Üì
   Backend Implementation
   (Zap, Datadog, etc.)
```

### Principais Vantagens

- **Vendor Independence**: Troque providers sem alterar c√≥digo
- **Consistent API**: Interface unificada para todos os providers
- **Type Safety**: APIs type-safe com Go generics
- **Performance**: Overhead m√≠nimo e otimiza√ß√µes por provider
- **Testing**: Mocks centralizados para todos os componentes

## üìä Compara√ß√£o de Providers

### Logger Providers

| Provider | Performance | Features | Memory | Use Case |
|----------|-------------|----------|---------|----------|
| **Zap** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | High-performance APIs |
| **Logrus** | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | Feature-rich applications |
| **Slog** | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê | Go 1.21+ applications |

### Tracer Providers

| Provider | Setup | Features | Cost | Use Case |
|----------|-------|----------|------|----------|
| **Datadog** | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | üí∞üí∞üí∞ | Enterprise APM |
| **Grafana** | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê | üí∞ | Open-source stack |
| **New Relic** | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | üí∞üí∞ | Full observability |
| **OpenTelemetry** | ‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | Free | Vendor-neutral |

## üîß Configura√ß√£o Avan√ßada

### Logger com Context Propagation

```go
// Logger com correlation IDs
ctx := logger.WithFields(context.Background(), 
    logger.String("trace_id", "abc123"),
    logger.String("user_id", "user456"),
)

log.Info(ctx, "Processing request")
// Output: {"level":"info","trace_id":"abc123","user_id":"user456","msg":"Processing request"}
```

### Tracer com Custom Tags

```go
// Tracer com tags personalizados
span := tracer.StartSpan(ctx, "database-query")
span.SetTag("db.table", "users")
span.SetTag("db.operation", "SELECT")
span.SetTag("query.rows", 150)

// Correla√ß√£o com logs
logger.Info(ctx, "Query executed", 
    logger.String("span_id", span.ID()),
    logger.Duration("duration", span.Duration()),
)
```

### Configuration Management

```go
// Configura√ß√£o centralizada
type ObservabilityConfig struct {
    Logger LoggerConfig `yaml:"logger"`
    Tracer TracerConfig `yaml:"tracer"`
}

// Carregar de arquivo
config, err := LoadConfigFromFile("observability.yaml")
if err != nil {
    log.Fatal("Failed to load config", err)
}
```

## üß™ Testing

### Unit Tests com Mocks

```go
func TestUserService(t *testing.T) {
    // Setup mocks
    mockLogger := logger_mocks.NewMockProvider()
    mockTracer := tracer_mocks.NewMockProvider()
    
    logger := logger.NewLogger(mockLogger)
    tracer := tracer.NewTracer(mockTracer)
    
    service := NewUserService(logger, tracer)
    
    // Test
    user, err := service.GetUser(ctx, "123")
    
    // Assertions
    assert.NoError(t, err)
    assert.Equal(t, "123", user.ID)
    
    // Verify observability calls
    mockLogger.AssertLogCalled(t, "info", "User retrieved")
    mockTracer.AssertSpanStarted(t, "user-service.get-user")
}
```

### Integration Tests

```bash
# Usar infraestrutura real para testes
make infra-up
make test-integration

# Ou grupos espec√≠ficos
make dev-tracer
make test-integration-tracer
```

## üöÄ Performance

### Benchmarks

```bash
# Logger performance
go test -bench=BenchmarkLogger -benchmem ./logger/...

# Tracer performance  
go test -bench=BenchmarkTracer -benchmem ./tracer/...

# Com infraestrutura real
make perf-test
```

### Otimiza√ß√µes

- **Zero-allocation logging** com Zap provider
- **Sampling strategies** para high-throughput
- **Async processing** para opera√ß√µes I/O
- **Connection pooling** para backends remotos
- **Batch processing** para m√∫ltiplas opera√ß√µes

## üîê Seguran√ßa

### Dados Sens√≠veis

```go
// Sanitiza√ß√£o autom√°tica
logger.Info(ctx, "User authenticated",
    logger.String("user_id", userID),
    logger.Redacted("password", password), // Ser√° mostrado como [REDACTED]
    logger.PII("email", email),           // Ser√° hasheado em prod
)
```

### Network Security

```go
// TLS para backends remotos
config := datadog.Config{
    APIKey:  os.Getenv("DD_API_KEY"),
    UseTLS:  true,
    Timeout: 10 * time.Second,
}
```

## üìà Production Readiness

### Health Checks

```go
// Health check para observability
func (s *Server) HealthCheck(w http.ResponseWriter, r *http.Request) {
    ctx := r.Context()
    
    // Verificar logger
    if !s.logger.IsHealthy(ctx) {
        http.Error(w, "Logger unhealthy", http.StatusServiceUnavailable)
        return
    }
    
    // Verificar tracer
    if !s.tracer.IsHealthy(ctx) {
        http.Error(w, "Tracer unhealthy", http.StatusServiceUnavailable)
        return
    }
    
    w.WriteHeader(http.StatusOK)
    json.NewEncoder(w).Encode(map[string]string{"status": "healthy"})
}
```

### Graceful Shutdown

```go
// Shutdown com flush de buffers
func (s *Server) Shutdown(ctx context.Context) error {
    // Flush tracer buffers
    if err := s.tracer.Shutdown(ctx); err != nil {
        s.logger.Error(ctx, "Failed to shutdown tracer", logger.Error(err))
    }
    
    // Flush logger buffers  
    if err := s.logger.Shutdown(ctx); err != nil {
        fmt.Printf("Failed to shutdown logger: %v\n", err)
    }
    
    return nil
}
```

## ü§ù Contribui√ß√£o

### Development Setup

```bash
# Setup ambiente de desenvolvimento
git clone <repository-url>
cd nexs-lib/observability

# Iniciar infraestrutura
make dev-setup

# Executar testes
make test-integration

# Validar c√≥digo
go fmt ./...
go vet ./...
golangci-lint run
```

### Adicionando Novos Providers

1. **Implementar interface do provider**
2. **Adicionar testes unit√°rios com mocks**
3. **Criar exemplo pr√°tico**
4. **Documentar configura√ß√µes**
5. **Integrar com CI/CD**

### Code Style

- Seguir [Go Code Review Comments](https://github.com/golang/go/wiki/CodeReviewComments)
- Usar `gofmt` e `goimports`
- Documentar APIs p√∫blicas
- Manter coverage > 90%

## üìã Roadmap

### Pr√≥ximas Releases

#### v1.1.0 - Metrics Integration
- [ ] Prometheus metrics provider
- [ ] Custom metrics collection
- [ ] Dashboard templates
- [ ] Performance monitoring

#### v1.2.0 - Advanced Features  
- [ ] Correlation autom√°tica trace/log
- [ ] Context propagation aprimorado
- [ ] Sampling strategies avan√ßadas
- [ ] Error tracking integration

#### v1.3.0 - Cloud Native
- [ ] Kubernetes integration
- [ ] Service mesh support
- [ ] Cloud provider optimizations
- [ ] Auto-scaling integration

## üìû Suporte

### Recursos
- [üìñ Documenta√ß√£o](./NEXT_STEPS.md)
- [üí° Exemplos](./tracer/examples/)
- [üêõ Issues](https://github.com/fsvxavier/nexs-lib/issues)
- [üí¨ Discussions](https://github.com/fsvxavier/nexs-lib/discussions)

### FAQ

**Q: Posso usar m√∫ltiplos providers simultaneamente?**
A: Sim, voc√™ pode configurar diferentes providers para diferentes servi√ßos ou ambientes.

**Q: Como migrar de outras bibliotecas?**
A: Consulte nossos [guias de migra√ß√£o](./docs/migration/) para bibliotecas populares.

**Q: Qual o overhead de performance?**
A: < 1ms de lat√™ncia adicional em 99% dos casos. Veja nossos [benchmarks](./docs/performance/).

## üìù Licen√ßa

Este projeto est√° licenciado sob a [MIT License](../LICENSE).

---

## üéØ Status do Projeto

- **Logger**: ‚úÖ Production ready
- **Tracer**: ‚úÖ Production ready  
- **Infrastructure**: ‚úÖ Development ready
- **Documentation**: ‚úÖ Complete
- **Examples**: ‚úÖ Complete
- **Tests**: ‚úÖ Complete

**Current Status**: üöÄ **Ready for production use with comprehensive development infrastructure**
