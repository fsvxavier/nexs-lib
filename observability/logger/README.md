# Logger System - nexs-lib

Sistema de logging robusto e extens√≠vel para Go com suporte a m√∫ltiplos providers, logging estruturado e consciente de contexto.

## ‚ú® Caracter√≠sticas

- **Multi-Provider**: Suporte para slog, zap e zerolog
- **Provider Padr√£o**: Zap configurado automaticamente como padr√£o
- **Logging Estruturado**: Campos tipados e validados
- **Context-Aware**: Extra√ß√£o autom√°tica de trace_id, span_id, user_id, request_id
- **Flex√≠vel**: Troca de providers em runtime
- **Configur√°vel**: N√≠veis, formatos, sampling e stacktraces
- **Perform√°tico**: Otimizado para alta throughput
- **Testado**: Cobertura de testes > 98%

## ÔøΩ Instala√ß√£o

```bash
go get github.com/fsvxavier/nexs-lib/observability/logger
```

## üìã Providers Suportados

### 1. **zap** (Uber) - PADR√ÉO
- **Provider padr√£o** configurado automaticamente
- Alta performance com zero allocation
- Stacktraces detalhados
- Configura√ß√£o avan√ßada de encoders

### 2. **slog** (Go Standard Library)
- Provider padr√£o do Go 1.21+
- Balanceamento ideal entre performance e funcionalidades
- Suporte completo a structured logging

### 3. **zerolog** (RS)
- Zero allocation JSON logger
- Extremamente eficiente
- Formato JSON nativo

Resultados de performance obtidos com o exemplo `examples/benchmark/`:

### Ranking Geral (M√©dia de todos os cen√°rios)
ü•á **zap**: ~240,000 logs/seg (Alta performance, ideal para aplica√ß√µes cr√≠ticas)
ü•à **zerolog**: ~174,000 logs/seg (JSON nativo, boa efici√™ncia de mem√≥ria)
ü•â **slog**: ~132,000 logs/seg (Padr√£o Go, melhor compatibilidade)

### Performance por Cen√°rio

| Cen√°rio | slog | zap | zerolog | Melhor |
|---------|------|-----|---------|--------|
| **Logs Simples** | 189k logs/seg | **401k logs/seg** | 257k logs/seg | zap |
| **Logs Estruturados** | 117k logs/seg | **223k logs/seg** | 156k logs/seg | zap |
| **Logs com Contexto** | 148k logs/seg | **306k logs/seg** | 183k logs/seg | zap |
| **Logs de Erro** | 120k logs/seg | **213k logs/seg** | 173k logs/seg | zap |
| **Logs Formatados** | 125k logs/seg | 174k logs/seg | **198k logs/seg** | zerolog |
| **Logs Complexos** | 92k logs/seg | **125k logs/seg** | 80k logs/seg | zap |

### Efici√™ncia de Mem√≥ria
- **zerolog**: Mais eficiente na maioria dos cen√°rios
- **slog**: Bom equil√≠brio entre performance e uso de mem√≥ria
- **zap**: Foca em performance m√°xima, pode usar mais mem√≥ria

### Uso de benchmark detalhado
```bash
cd examples/benchmark
go run main.go  # Executa benchmark completo com m√©tricas detalhadas
```s tipados e validados
- **Context-Aware**: Extra√ß√£o autom√°tica de trace_id, span_id, user_id, request_id
- **Flex√≠vel**: Troca de providers em runtime
- **Configur√°vel**: N√≠veis, formatos, sampling e stacktraces
- **Perform√°tico**: Otimizado para alta throughput
- **Testado**: Cobertura de testes > 98%

## üöÄ Instala√ß√£o

```bash
go get github.com/fsvxavier/nexs-lib/observability/logger
```

## üìã Providers Suportados

### 1. **slog** (Go Standard Library)
- Provider padr√£o do Go 1.21+
- Balanceamento ideal entre performance e funcionalidades
- Suporte completo a structured logging

### 2. **zap** (Uber)
- Alta performance com zero allocation
- Stacktraces detalhados
- Configura√ß√£o avan√ßada de encoders

### 3. **zerolog** (RS)
- Zero allocation JSON logger
- Extremamente eficiente
- Formato JSON nativo

## üîß Uso B√°sico

### Uso R√°pido (com Provider Padr√£o)

```go
package main

import (
    "context"
    "github.com/fsvxavier/nexs-lib/observability/logger"
    
    // Importa providers para auto-registra√ß√£o
    _ "github.com/fsvxavier/nexs-lib/observability/logger/providers/zap"
    _ "github.com/fsvxavier/nexs-lib/observability/logger/providers/slog"
    _ "github.com/fsvxavier/nexs-lib/observability/logger/providers/zerolog"
)

func main() {
    ctx := context.Background()
    
    // Zap √© configurado automaticamente como provider padr√£o
    logger.Info(ctx, "Aplica√ß√£o iniciada")
    logger.Debug(ctx, "Debug info", logger.String("key", "value"))
    
    // Verifica qual provider est√° sendo usado
    currentProvider := logger.GetCurrentProviderName()
    fmt.Printf("Provider atual: %s\n", currentProvider) // Output: zap
}
```

### Configura√ß√£o Personalizada

```go
package main

import (
    "context"
    "github.com/fsvxavier/nexs-lib/observability/logger"
    
    // Importa providers para auto-registra√ß√£o
    _ "github.com/fsvxavier/nexs-lib/observability/logger/providers/slog"
    _ "github.com/fsvxavier/nexs-lib/observability/logger/providers/zap"
    _ "github.com/fsvxavier/nexs-lib/observability/logger/providers/zerolog"
)

func main() {
    // Configura√ß√£o personalizada (substitui a configura√ß√£o padr√£o)
    config := logger.DefaultConfig()
    config.Level = logger.InfoLevel
    config.Format = logger.JSONFormat
    config.ServiceName = "meu-app"
    config.ServiceVersion = "1.0.0"
    config.Environment = "production"
    
    // Configura o provider zap com configura√ß√£o personalizada
    err := logger.ConfigureProvider("zap", config)
    if err != nil {
        panic(err)
    }
    
    // Define como provider ativo (opcional, pois zap j√° √© padr√£o)
    err = logger.SetActiveProvider("zap")
    if err != nil {
        panic(err)
    }
    
    // Usa o logger
    ctx := context.Background()
    logger.Info(ctx, "Aplica√ß√£o iniciada")
    logger.Debug(ctx, "Debug info", logger.String("key", "value"))
}
```
    _ "github.com/fsvxavier/nexs-lib/observability/logger/providers/zap"
    _ "github.com/fsvxavier/nexs-lib/observability/logger/providers/zerolog"
)

func main() {
    // Configura√ß√£o b√°sica
    config := logger.DefaultConfig()
    config.Level = logger.InfoLevel
    config.Format = logger.JSONFormat
    config.ServiceName = "meu-app"
    config.ServiceVersion = "1.0.0"
    config.Environment = "production"
    
    // Configura o provider slog
    err := logger.ConfigureProvider("slog", config)
    if err != nil {
        panic(err)
    }
    
    // Define como provider ativo
    err = logger.SetActiveProvider("slog")
    if err != nil {
        panic(err)
    }
    
    // Usa o logger
    ctx := context.Background()
    logger.Info(ctx, "Aplica√ß√£o iniciada")
    logger.Debug(ctx, "Debug info", logger.String("key", "value"))
}
```

### Context-Aware Logging

```go
// Cria contexto com informa√ß√µes de rastreamento
ctx := context.Background()
ctx = context.WithValue(ctx, logger.TraceIDKey, "trace-123")
ctx = context.WithValue(ctx, logger.SpanIDKey, "span-456")
ctx = context.WithValue(ctx, logger.UserIDKey, "user-789")
ctx = context.WithValue(ctx, logger.RequestIDKey, "req-101")

// Automaticamente inclui os campos do contexto
logger.Info(ctx, "Processando requisi√ß√£o")
logger.Error(ctx, "Erro no processamento", logger.String("error", "details"))
```

### Logging Estruturado

```go
// Diferentes tipos de campos
logger.Info(ctx, "Opera√ß√£o completada",
    logger.String("operation", "create_user"),
    logger.Int("user_id", 123),
    logger.Bool("success", true),
    logger.Duration("elapsed", time.Millisecond*150),
    logger.Float64("score", 95.5),
    logger.Time("timestamp", time.Now()),
)

// Logs formatados
logger.Infof(ctx, "Processados %d items em %v", 100, time.Second)

// Logs com c√≥digo de erro
logger.ErrorWithCode(ctx, "E001", "Falha na valida√ß√£o",
    logger.String("field", "email"),
    logger.String("value", "invalid-email"),
)
```

### Configura√ß√£o Avan√ßada

```go
config := &logger.Config{
    Level:          logger.DebugLevel,
    Format:         logger.JSONFormat,
    Output:         os.Stdout,
    AddSource:      true,
    AddStacktrace:  true,
    TimeFormat:     time.RFC3339,
    ServiceName:    "api-service",
    ServiceVersion: "2.1.0",
    Environment:    "production",
    Fields: map[string]any{
        "region":    "us-east-1",
        "component": "auth",
    },
    SamplingConfig: &logger.SamplingConfig{
        Initial:    100,
        Thereafter: 10,
    },
}
```

## üîÑ Troca de Providers

```go
// Configura m√∫ltiplos providers
providers := []string{"slog", "zap", "zerolog"}
for _, provider := range providers {
    err := logger.ConfigureProvider(provider, config)
    if err != nil {
        log.Fatal(err)
    }
}

// Troca providers em runtime
logger.SetActiveProvider("zap")    // Usa zap
logger.Info(ctx, "Usando zap")

logger.SetActiveProvider("zerolog") // Usa zerolog
logger.Info(ctx, "Usando zerolog")
```

## üéØ Contexto Pr√©-definido

```go
// Logger com campos fixos
contextLogger := logger.WithFields(
    logger.String("module", "auth"),
    logger.String("operation", "login"),
)

// Logger com contexto extra√≠do
ctxLogger := logger.WithContext(ctx)

// Todos os logs subsequentes incluem os campos
contextLogger.Info(ctx, "Tentativa de login")
contextLogger.Error(ctx, "Falha na autentica√ß√£o")
```

## ÔøΩ Exemplos Pr√°ticos

O sistema de logging inclui quatro exemplos completos que demonstram diferentes cen√°rios de uso:

### 1. Exemplo B√°sico (`examples/basic/`)
Demonstra o uso b√°sico do sistema com todos os tr√™s providers:

```bash
cd examples/basic
go run main.go
```

**Funcionalidades demonstradas:**
- Configura√ß√£o b√°sica de cada provider
- Logging estruturado com campos tipados
- Context-aware logging com trace_id, user_id, etc.
- Compara√ß√£o de formatos (Console vs JSON)
- Configura√ß√£o por vari√°veis de ambiente

### 2. Exemplo Avan√ßado (`examples/advanced/`)
Cen√°rios mais complexos com servi√ßos e middleware:

```bash
cd examples/advanced
go run main.go
```

**Funcionalidades demonstradas:**
- Integra√ß√£o com servi√ßos (UserService)
- Middleware HTTP com logging autom√°tico
- Diferentes formatos de sa√≠da (Console, Text, JSON)
- Configura√ß√£o espec√≠fica por ambiente
- Tratamento de erros com domain errors
- Logging comparativo entre providers
- Benchmarks de performance

### 3. Exemplo Multi-Provider (`examples/multi-provider/`)
Demonstra√ß√£o completa da arquitetura multi-provider:

```bash
cd examples/multi-provider
go run main.go
```

**Funcionalidades demonstradas:**
- Configura√ß√£o de m√∫ltiplos providers
- Troca de providers em runtime
- Benchmarks comparativos de performance
- Context-aware logging
- Logging estruturado com diferentes tipos de campos
- Extra√ß√£o autom√°tica de contexto

### 4. Benchmark Completo (`examples/benchmark/`)
An√°lise detalhada de performance de todos os providers:

```bash
cd examples/benchmark
go run main.go
```

**Funcionalidades demonstradas:**
- Benchmarks detalhados com m√©tricas de mem√≥ria e GC
- Testes de diferentes cen√°rios (simples, estruturados, contexto, erros)
- An√°lise comparativa de performance
- Recomenda√ß√µes de uso baseadas em dados
- Informa√ß√µes do sistema e estat√≠sticas detalhadas

### Executar Todos os Exemplos

```bash
# Script para testar todos os exemplos
chmod +x test_examples.sh
./test_examples.sh
```

## ÔøΩüìä Benchmarks

Resultados de performance (1000 logs com campos estruturados):

| Provider | Tempo Total | Tempo/Log | Logs/Segundo |
|----------|-------------|-----------|--------------|
| slog     | ~45ms       | ~45¬µs     | ~22,000      |
| zap      | ~25ms       | ~25¬µs     | ~40,000      |
| zerolog  | ~58ms       | ~58¬µs     | ~17,000      |

> **Nota**: Resultados podem variar dependendo do hardware e configura√ß√£o

## üß™ Testes

```bash
# Executar todos os testes
go test ./...

# Executar testes com coverage
go test -cover ./...

# Executar benchmarks
go test -bench=. ./...
```

## üìÅ Estrutura do Projeto

```
observability/logger/
‚îú‚îÄ‚îÄ interfaces/
‚îÇ   ‚îî‚îÄ‚îÄ interfaces.go       # Interfaces e tipos
‚îú‚îÄ‚îÄ providers/
‚îÇ   ‚îú‚îÄ‚îÄ slog/              # Provider slog
‚îÇ   ‚îú‚îÄ‚îÄ zap/               # Provider zap
‚îÇ   ‚îî‚îÄ‚îÄ zerolog/           # Provider zerolog
‚îú‚îÄ‚îÄ examples/
‚îÇ   ‚îú‚îÄ‚îÄ basic/             # Exemplo b√°sico
‚îÇ   ‚îú‚îÄ‚îÄ advanced/          # Exemplo avan√ßado
‚îÇ   ‚îú‚îÄ‚îÄ multi-provider/    # Exemplo multi-provider
‚îÇ   ‚îî‚îÄ‚îÄ benchmark/         # Benchmark completo
‚îú‚îÄ‚îÄ mocks/
‚îÇ   ‚îî‚îÄ‚îÄ mocks.go           # Mocks para testes
‚îú‚îÄ‚îÄ logger.go              # API principal
‚îú‚îÄ‚îÄ manager.go             # Gerenciamento de providers
‚îî‚îÄ‚îÄ README.md              # Esta documenta√ß√£o
```

## üé® Formatos de Sa√≠da

### JSON Format
```json
{
  "time": "2025-07-18T15:59:50-03:00",
  "level": "INFO",
  "msg": "Processando requisi√ß√£o",
  "service": "api-service",
  "version": "1.0.0",
  "environment": "production",
  "trace_id": "trace-123",
  "span_id": "span-456",
  "user_id": "user-789",
  "request_id": "req-101"
}
```

### Console Format
```
2025-07-18T15:59:50-03:00 INFO Processando requisi√ß√£o service=api-service version=1.0.0 trace_id=trace-123
```

## üîí Configura√ß√µes de Seguran√ßa

```go
// Configura√ß√£o para produ√ß√£o
config := logger.ProductionConfig()
config.Level = logger.InfoLevel
config.AddSource = false      // Remove info do c√≥digo fonte
config.AddStacktrace = false  // Remove stacktraces exceto para Fatal/Panic
config.SamplingConfig = &logger.SamplingConfig{
    Initial:    100,
    Thereafter: 10,           // Sampling para controle de volume
}
```

## üöÄ Pr√≥ximos Passos

- [x] Implementar providers slog, zap e zerolog
- [x] Sistema de configura√ß√£o flex√≠vel
- [x] Context-aware logging
- [x] Testes unit√°rios e de integra√ß√£o
- [x] Benchmarks de performance
- [x] Documenta√ß√£o completa
- [ ] M√©tricas de logging
- [ ] Hooks customizados
- [ ] Rota√ß√£o de logs
- [ ] Integra√ß√£o com sistemas de monitoramento

## üìù Contribuindo

1. Fork o projeto
2. Crie uma branch para sua feature
3. Fa√ßa commit das mudan√ßas
4. Abra um Pull Request

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo LICENSE para mais detalhes.

## üÜò Suporte

Para d√∫vidas ou problemas, abra uma issue no reposit√≥rio ou consulte a documenta√ß√£o t√©cnica em `/docs`.
